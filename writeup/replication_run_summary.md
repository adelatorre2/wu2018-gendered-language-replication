# Replication Run Summary (Wu 2018)

## Package and location
- Upstream package: OpenICPSR replication package for Wu (2018), “Gendered Language on the Economics Job Market Rumors Forum.”
- Local path in this repo: `data/raw/openicpsr_wu2018_replication-pkg/`

## Pipeline command
- `python src/run_all.py`

## What the pipeline does
1. Runs the upstream Lasso scripts (full sample and pronoun sample) from the `lasso/` directory so their relative paths resolve correctly.
2. Copies the Lasso intermediates from the raw package root into `output/intermediate/`.
3. Runs the upstream R script (`tables-figures.R`) to produce Table 1, Table 2, and Figure 1, saving them into `output/tables/` and `output/figures/`.
4. Captures logs for each step in `output/logs/`.

## Outputs produced (observed)
- Figure 1: `output/figures/figure1.pdf`
- Table 1: `output/tables/table1.csv`
- Table 2: `output/tables/table2.csv`
- Lasso intermediates:
  - `output/intermediate/lasso_full/coef_lasso_logit_full.txt`
  - `output/intermediate/lasso_full/ypred_*.txt`
  - `output/intermediate/lasso_full/i_keep_columns.txt`
  - `output/intermediate/lasso_pronoun/coef_lasso_logit_pronoun.txt`
  - `output/intermediate/lasso_pronoun/ypred_pronoun_*.txt`
  - `output/intermediate/lasso_pronoun/i_keep_columns.txt`
- Logs:
  - `output/logs/lasso_logit_full.log`
  - `output/logs/lasso_logit_pronoun.log`
  - `output/logs/tables_figures.log`

## Extension outputs (this repo)
- Overlap summary table (generated by `writeup/paper/make_tables.py`):
  - `output/tables/overlap_full_vs_pronoun.csv`

## Runtime and platform notes
- OS/arch: macOS (Darwin) arm64.
- Python/conda: logs show execution under conda env `wu2018` (`/opt/anaconda3/envs/wu2018/bin/python`).
- The Lasso scripts train on large sparse matrices; logs print matrix shapes, confirming the expected split sizes (e.g., full sample train/test/test1 shapes in `lasso_logit_full.log`).

## Obstacles encountered + fixes applied
- **Pandas deprecation:** replaced deprecated `as_matrix()` with `to_numpy()` in upstream Lasso scripts.
- **NumPy compatibility:** added `allow_pickle=True` to `np.load(...)` for legacy `.npz` sparse matrices.
- These are compatibility-only changes; analysis logic is unchanged.

## How to reproduce (short)
1. Create and activate the conda environment:
   - `conda env create -f environment/environment.yml`
   - `conda activate wu2018`
2. Install R + ggplot2:
   - `conda install -c conda-forge r-base r-ggplot2`
3. Ensure the OpenICPSR package is in `data/raw/openicpsr_wu2018_replication-pkg/`.
4. Run the pipeline:
   - `python src/run_all.py`
